<include file="Public:header" />
<div class="rowbox box960">
    <include file="Public:submenu" />
    <form action="__URL__" method="POST">
        <p class="list-search"><span>Search</span><input class="searcher ml-10" type="text" name="search" value=""/></p>
    </form>
    <div class="m-10"><div class="button" id="add-user-btn"><span class="add"><a href="javascript:;" >Add Client</span></a></div></div>
    <div class="sepline"></div>
    <table id="table-{$Think.MODULE_NAME|strtolower}-{$Think.ACTION_NAME|strtolower}" class="listdata ml-30 mt-30" cellpadding="0" cellspacing="0" border="0">
        <thead>
        <tr>
            <th width="15%">ID</th>
            <th width="20%">Account</th>
            <th width="20%">Nickname</th>
            <th width="15%">Password</th>
            <th width="15%">Status</th>
            <th width="15%">Operation</th>
        </tr>
        </thead>
        <tbody>
        <volist name="list" id="vo">
        <tr>
            <td>{$vo.id}</td>
            <td>{$vo.account}</td>
            <td>{$vo.nickname}</td>
            <td>{$vo.password}</td>
            <td>{$vo.enable}</td>
            <td>[<a class="edit" href="javascript:;" data="{$vo.id}" title="Edit">Edit</a>]&nbsp;&nbsp;[<a class="delete" href="javascript:;" data="{$vo.id}" title="Delete">Delete</a>]<br />[<a target="_blank" href="__URL__/product/uid/{$vo.id}" title="Products">Products</a>]</td>
        </tr>
        </volist>
        </tbody>
    </table>
    {$page}
</div>
<div id="add-client-dialog" class="dialog">
    <div class="menu_content">
    <form action="__URL__/add" name="clientForm" method="POST">
        <ul>
            <li>
                <label for="ClientName">Nickname:</label><input type="text" name="nickname"/>
            </li>
            <li>
                <label for="ClientName">Account:</label><input type="text" name="account"/>
            </li>
            <li>
                <label for="Password">Password:</label><input type="text" name="password"/>
            </li>
            <!-- <li>
                <label for="Project">Project:</label><input type="text" name="Project"/>
            </li>
            <li>
                <label for="Categories">Categories:</label><input type="text" name="Categories"/>
            </li> -->
        </ul>
        <div class="button-bar">
            <div class="button"><a href="javascript:;">Save</a></div>
            <div class="button"><a href="javascript:;">Cancel</a></div>
        </div>
    </form>
    </div>
</div>
<div id="edit-client-dialog" class="dialog"></div>
<include file="Public:footer" />
<script type="text/javascript">
<!--
$(function() {
    $('#add-user-btn').click(function(){
        loadEditDialog('Edit Client');
    });

    var $table = $('#table-{$Think.MODULE_NAME|strtolower}-{$Think.ACTION_NAME|strtolower}');
    $('.delete',$table).click(function(){
        var editId = $(this).attr('data');
        App.confirm('Delete Client','Are you sure to delete this client?',function(){
            var url = "__URL__/delClient";
            $.post(url, {uid:editId}, function(response) {
                if(response.status) {
                    window.location.reload();
                } else {
                    if(response.error) {
                        App.alert('Delete Client','Delete client fail.');
                    }
                }
            });
        });
    });

    $('.edit',$table).click(function(){
        var editId = $(this).attr('data');
        loadEditDialog('Edit Client',editId);
    });
});

function loadEditDialog(title,uid) {
    $dialog  = $('#edit-client-dialog');
    var url     = '__URL__/editClient';
    if(typeof (uid) != 'undefined')url += '/uid/' + uid;
    $options = {title:title,width:750,modal:true};
    $dialog.dialog($options);
    $dialog.loadTpl(url,function(){
        $('#save-btn').click(function(){
            var $form   = $dialog.find('form').eq(0);
            var subUrl  = '__URL__/submitClient';
            var options = {
                dataType        : 'json',
                url             : subUrl,
                success         : function(response) { 
                    if(response.status) {
                        $dialog.dialog( "close" );
                        window.location.reload();
                    }
                    else {
                        if(response.error) {
                            App.alert(title,response.error);
                        }
                        else {
                            App.alert(title,'Operate fail.');
                        }
                    }
                }
            };
            $form.ajaxForm(options); 
            $form.submit();
        });
        $('#cancel-btn').click(function(){
            $dialog.dialog( "close" );
        });
    }, false);
}
//-->
</script>

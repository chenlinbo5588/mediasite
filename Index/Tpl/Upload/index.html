<link href="__PUBLIC__/Css/swfupload.css" rev="stylesheet" rel="stylesheet" type="text/css" media="screen">
<div class="menu_content">
    <form name="uploadForm" action="/upload/saveupload/" method="post" onsubmit="return validationForm(this);">
	
	
	<ul class="upload">
	    <li><label>File Type:</label><select name="file_type" id="file_type">
		    <option value="">Please Select</option>
		    <volist name="fileType" id="vo">
		    <option value="{$vo.id},{$vo.name}">{$vo.title}</option>
		    </volist>
		</select>
	    </li>
	    
	    <!-- when choose type movie -->
	    <li id="uploadImageFile"><label>Cover Image:</label>
		<input type="hidden" name="Uploader_Value_1" id="Uploader_Value_1" value=""/>
		<input type="text" name="Uploader_Show_Value_1" id="Uploader_Show_Value_1" value="" readonly="readonly"/>
		<span id="UploaderPlaceholder_1"></span>
		<span class="Uploader" allowSize="512KB" allowFile="*.jpg;*.jpeg;*.png;" style="display:none;" >Please Choose Files</span>
	    </li>
	    <li><label></label>
		<div id="UploaderProgress_1"></div>
		<div id="UploaderFeedBack_1"></div>
	    </li>
	    
	    <li><label>Video File:</label>
		<input type="hidden" name="Uploader_Value_2" id="Uploader_Value_2" value=""/>
		<input type="text" name="Uploader_Show_Value_2" id="Uploader_Show_Value_2" value="" readonly="readonly"/>
		<span id="UploaderPlaceholder_2"></span>
		<span class="Uploader" allowSize="50MB" allowFile="*.flv;*.mp4;*.avi;" style="display:none;" >Please Choose Files</span>
	    </li>
	    <li>
		<div id="UploaderProgress_2"></div>
		<div id="UploaderFeedBack_2"></div>
	    </li>
	    <li>
		<label>Video Parameter:</label>
		    <span>Width:</span><input type="text" style="width:50px;" name="width" value="600"/>
		    <span>Height:</span><input type="text" style="width:50px;" name="height" value="450"/>
	    </li>
	    
	    
	    <li <if condition="$showClient eq 0">style="display:none;"</if>>
		<label>Client:</label><select name="client" id="client">
		    <option value="">Please Choose</option>
		    <volist name="client" id="vo">
		    <option value="{$vo.id},{$vo.account}">{$vo.account}</option>
		    </volist>
		</select>
	    </li>
	    <li>
		<label>Product:</label><select name="product" id="product">
		    <option value="" >Please Choose</option>
		    <volist name="product" id="vo">
		    <option value="{$vo.id}">{$vo.name}</option>
		    </volist>
		</select>
	    </li>

	    <li>
		<label>Project:</label><select name="project" id="project">
		    <option value="" >Please Choose</option>
		</select>
	    </li>
	    <!--
	    <li>
		<label>Folder:</label><select name="folder" id="folder">
		    <option value=""></option>
		</select>
	    </li>
	    -->
	</ul>
	<input type="hidden" name="fid" value="{$vo.fid}" />
        <div class="button-bar pt-20">
            <div class="button"><a id="save-btn" href="javascript:;">Save</a></div>
            <div class="button"><a id="cancel-btn" href="javascript:;">Cancel</a></div>
        </div>
    </form>
</div>

<script type="text/javascript" src="__PUBLIC__/Javascript/swfup/swfupload.js"></script>
<script type="text/javascript" src="__PUBLIC__/Javascript/swfup/swfupload.queue.js"></script>
<script type="text/javascript" src="__PUBLIC__/Javascript/swfup/fileprogress.js"></script>
<script type="text/javascript" src="__PUBLIC__/Javascript/swfup/handlers.js"></script>
<script type="text/javascript">
var uploads = [];
var sid = '{$sid}';
$(function(){
    $(".Uploader").each(function(index){	
        uploads.push(createSwfUpload(index + 1,$(this).attr("allowSize"),$(this).attr("allowFile")));
    });
    
    /*
    $("#file_type").change(function(e){
	var mov = /movie/i;
	
	if(mov.test($(this).val())){
	    $("#uploadImageFile").show();
	}else{
	    $("#uploadImageFile").hide();
	}
    });*/
    
    $("#client").change(function(e){
	if('' == $("#client").val()){
	    return;
	}
	
	$.getJSON("__APP__/Product/getUserProduct",{user_id: $("#client").val()},function(data){
	    $("#product").html(data.body);
	    
	    if($("#product").val() != ''){
		$.getJSON("__APP__/Project/getUserProject",{user_id: $("#client").val(),product_id : $("#product").val()},function(data){
		    $("#project").html(data.body);
		});
	    }
	});
    })
    
    $("#product").change(function(e){
	if('' == $("#client").val() || '' == $("#product").val()){
	    return;
	}
	$.getJSON("__APP__/Project/getUserProject",{user_id: $("#client").val(),product_id : $("#product").val()},function(data){
	    $("#project").html(data.body);
	});
    })
});

function validationForm(form){
    if('' == $("#file_type").val()){
	alert("Please Choose File Type");
	$("#file_type").focus();
	return false;
    }
    
    /*
    var mov = /movie/i;
    if(mov.test($("#file_type").val()) && '' == $("#Uploader_Value_1").val()){
	alert("Please Choose Cover Image Type");
	$("#Uploader_Show_Value_1").focus();
	return false;
    }*/
    
    if('' == $("#Uploader_Value_1").val()){
	alert("Please Choose Image File");
	$("#Uploader_Show_Value_1").focus();
	return false;
    }
    
    if('' == $("#Uploader_Value_2").val()){
	alert("Please Choose File");
	$("#Uploader_Show_Value_2").focus();
	return false;
    }
    
    
    if('' == $("#client").val()){
	alert("Please Choose Client");
	$("#client").focus();
	return false;
    }
    
    if('' == $("#product").val()){
	alert("Please Choose Product");
	$("#product").focus();
	return false;
    }
    
    if('' == $("#project").val()){
	alert("Please Choose Project");
	$("#project").focus();
	return false;
    }
    

    return true;
}

function createSwfUpload(index,allowSize, allowFile){
    var upload = new SWFUpload({
	// Backend Settings
	upload_url: "__APP__/Upload/upload",
	post_params: {"PHPSESSID" : sid},
	// File Upload Settings
	//file_size_limit : "50MB",
	//file_types : "*.*;",
	file_size_limit : allowSize ,
	file_types : allowFile ,
	file_types_description : "Choose Files",
	file_upload_limit : "0",
	file_queue_limit : "0",
	// Event Handler Settings (all my handlers are in the Handler.js file)
	file_dialog_start_handler : fileDialogStart,
	file_queued_handler : fileQueued,
	file_queue_error_handler : fileQueueError,
	file_dialog_complete_handler : fileDialogComplete,
	upload_start_handler : uploadStart,
	upload_progress_handler : uploadProgress,
	upload_error_handler : uploadError,
	upload_success_handler : uploadSuccess,
	upload_complete_handler : uploadComplete,
	// Button Settingsimg/fee
	button_image_url : "__PUBLIC__/Images/XPButtonUploadText_61x22.png",
	button_placeholder_id : "UploaderPlaceholder_" + index,
	button_width: 61,
	button_height: 22,
	/*button_text: '<span class="theFont">Hello</span>',
	//button_text_style: ".theFont { font-size: 16; }",	
	//button_text : '<span class="redText">上传文件</span>',
	//button_text_style : ".redText {text-align:center;}",
	//button_text_left_padding: 12,
	//button_text_top_padding: 3,*/
	button_window_mode:"TRANSPARENT",
	button_cursor: SWFUpload.CURSOR.HAND,
	// Flash Settings
	flash_url : "__PUBLIC__/Flash/swfupload.swf",
	custom_settings : {
		progressTarget : "UploaderProgress_" + index,
		cancelButtonId : "UploaderCancelBtn_" + index,
		callback : function(file,serverData){
			var tmp = eval("(" + serverData + ")");
			if(1 == tmp.respcode){
			    $("#Uploader_Value_" + index).val(serverData);
			    $("#Uploader_Show_Value_" + index).val(tmp.source_filename);
			}else{
			    alert('Attachment Upload Failed，Please try it again!');
			}
		}
	},

	// Debug Settings
	debug: false
    });

    return upload;
}

</script>

